<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Umoja V2 • Register / Login</title>

  <style>
    :root{
      --bg:#ffffff;
      --text:#222;
      --muted:#8d8d8d;
      --line:#e9e9e9;
      --accent:#c7b08a;
      --field:#f3f3f3;
      --radius:14px;
      --shadow:0 12px 30px rgba(0,0,0,.08);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,Arial,sans-serif;
      background:var(--bg);
      color:var(--text);
    }
    .card{
      width:min(520px, 100%);
      background:#fff;
      border:1px solid var(--line);
      border-radius:20px;
      box-shadow:var(--shadow);
      padding:26px;
    }
    h1{
      margin:0 0 10px;
      font-size:44px;
      letter-spacing:-.02em;
    }
    .tabs{
      display:flex;
      gap:18px;
      margin:10px 0 18px;
    }
    .tab{
      cursor:pointer;
      padding:10px 2px;
      color:var(--muted);
      border-bottom:3px solid transparent;
      font-weight:600;
    }
    .tab.active{
      color:var(--text);
      border-color:var(--accent);
    }
    .field{
      background:var(--field);
      border:1px solid var(--line);
      border-radius:16px;
      padding:14px 14px;
      display:flex;
      align-items:center;
      gap:10px;
      margin:12px 0;
    }
    input{
      border:0;
      outline:none;
      background:transparent;
      width:100%;
      font-size:16px;
      color:var(--text);
    }
    .row{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
    }
    .link{
      color:var(--accent);
      cursor:pointer;
      font-weight:600;
      text-decoration:none;
    }
    .msg{
      margin:12px 0;
      padding:12px 14px;
      border-radius:14px;
      font-size:14px;
      border:1px solid var(--line);
      background:#fafafa;
      color:#333;
      display:none;
      white-space:pre-wrap;
    }
    .msg.ok{ background:#f2fbf4; border-color:#bfe5c8; }
    .msg.err{ background:#fff5f5; border-color:#f0b6b6; }
    .btn{
      width:100%;
      border:0;
      border-radius:16px;
      padding:16px 18px;
      font-size:16px;
      font-weight:700;
      cursor:pointer;
      background:var(--accent);
      color:#fff;
      margin-top:10px;
    }
    .btn.secondary{
      background:#fff;
      border:1px solid var(--line);
      color:#333;
      margin-top:10px;
    }
    .small{
      margin-top:14px;
      color:var(--muted);
      font-size:13px;
      line-height:1.35;
      text-align:center;
    }
    .uid{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size:12px;
    }
  </style>
</head>

<body>
  <div class="card">
    <h1>Register / Login</h1>

    <div class="tabs">
      <div id="tabRegister" class="tab active">Register</div>
      <div id="tabLogin" class="tab">Login</div>
    </div>

    <div id="status" class="msg"></div>

    <!-- Register Form -->
    <div id="registerPane">
      <div class="field">
        <input id="regId" placeholder="Email or Phone (e.g. name@email.com or +1 555 123 4567)" autocomplete="username" />
      </div>

      <div class="field">
        <input id="regPass" type="password" placeholder="Password (min 6 chars)" autocomplete="new-password" />
        <a id="regShow" class="link" style="margin-left:auto;">Show</a>
      </div>

      <button id="btnRegister" class="btn">Create Account</button>

      <div class="small">
        If you enter a phone number, we register it internally (no SMS). You can login later using the same phone + password.
      </div>

      <div class="small">
        Already have an account? <span class="link" id="goLogin">Login</span>
      </div>
    </div>

    <!-- Login Form -->
    <div id="loginPane" style="display:none;">
      <div class="field">
        <input id="logId" placeholder="Email or Phone" autocomplete="username" />
      </div>

      <div class="field">
        <input id="logPass" type="password" placeholder="Password" autocomplete="current-password" />
        <a id="logShow" class="link" style="margin-left:auto;">Show</a>
      </div>

      <button id="btnLogin" class="btn">Login</button>
      <button id="btnLogout" class="btn secondary" style="display:none;">Logout</button>

      <div class="small">
        New here? <span class="link" id="goRegister">Create account</span>
      </div>
    </div>

    <div class="small" id="uidLine" style="display:none;">
      Logged in ✅ UID: <span class="uid" id="uidText"></span>
    </div>
  </div>

  <!-- Firebase compat (works on simple HTML + GitHub Pages) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-auth-compat.js"></script>

  <script>
    // ✅ 1) PASTE YOUR REAL FIREBASE CONFIG HERE (from Firebase Console)
    const firebaseConfig = {
      apiKey: "PASTE_YOUR_API_KEY",
      authDomain: "PASTE_YOUR_AUTH_DOMAIN",
      projectId: "PASTE_YOUR_PROJECT_ID",
      storageBucket: "PASTE_YOUR_STORAGE_BUCKET",
      messagingSenderId: "PASTE_YOUR_SENDER_ID",
      appId: "PASTE_YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    // ---------- helpers ----------
    const $ = (id) => document.getElementById(id);

    function showMsg(text, type){
      const box = $("status");
      box.className = "msg " + (type || "");
      box.style.display = "block";
      box.textContent = text;
    }
    function clearMsg(){
      $("status").style.display = "none";
      $("status").textContent = "";
      $("status").className = "msg";
    }

    // Turn phone into a "fake email" so Email/Password auth can work without SMS
    function normalizeIdentifier(raw){
      const v = (raw || "").trim();
      if (!v) return "";

      // If it looks like an email, keep it
      if (v.includes("@")) return v.toLowerCase();

      // Otherwise treat as phone: keep digits only
      const digits = v.replace(/[^\d]/g, "");
      if (digits.length < 7) return ""; // too short to be a phone
      return digits + "@phone.umoja";
    }

    function togglePass(inputId, linkId){
      const inp = $(inputId);
      const link = $(linkId);
      if (inp.type === "password"){
        inp.type = "text";
        link.textContent = "Hide";
      } else {
        inp.type = "password";
        link.textContent = "Show";
      }
    }

    // ---------- tabs ----------
    function openRegister(){
      clearMsg();
      $("registerPane").style.display = "block";
      $("loginPane").style.display = "none";
      $("tabRegister").classList.add("active");
      $("tabLogin").classList.remove("active");
    }
    function openLogin(){
      clearMsg();
      $("registerPane").style.display = "none";
      $("loginPane").style.display = "block";
      $("tabLogin").classList.add("active");
      $("tabRegister").classList.remove("active");
    }

    $("tabRegister").onclick = openRegister;
    $("tabLogin").onclick = openLogin;
    $("goLogin").onclick = openLogin;
    $("goRegister").onclick = openRegister;

    $("regShow").onclick = () => togglePass("regPass","regShow");
    $("logShow").onclick = () => togglePass("logPass","logShow");

    // ---------- register ----------
    $("btnRegister").onclick = async () => {
      clearMsg();
      const id = normalizeIdentifier($("regId").value);
      const pass = $("regPass").value;

      if (!id) return showMsg("Enter a valid Email or Phone number.", "err");
      if (!pass || pass.length < 6) return showMsg("Password must be at least 6 characters.", "err");

      try{
        const cred = await auth.createUserWithEmailAndPassword(id, pass);
        showMsg("Account created ✅", "ok");
      } catch(e){
        showMsg(e.message || "Failed to create account.", "err");
      }
    };

    // ---------- login ----------
    $("btnLogin").onclick = async () => {
      clearMsg();
      const id = normalizeIdentifier($("logId").value);
      const pass = $("logPass").value;

      if (!id) return showMsg("Enter a valid Email or Phone number.", "err");
      if (!pass) return showMsg("Enter your password.", "err");

      try{
        await auth.signInWithEmailAndPassword(id, pass);
        showMsg("Logged in ✅", "ok");
      } catch(e){
        showMsg(e.message || "Login failed.", "err");
      }
    };

    $("btnLogout").onclick = async () => {
      await auth.signOut();
      showMsg("Logged out ✅", "ok");
    };

    // ---------- auth state ----------
    auth.onAuthStateChanged((user) => {
      if (user){
        $("uidLine").style.display = "block";
        $("uidText").textContent = user.uid;
        $("btnLogout").style.display = "block";
      } else {
        $("uidLine").style.display = "none";
        $("uidText").textContent = "";
        $("btnLogout").style.display = "none";
      }
    });
  </script>
</body>
</html>
